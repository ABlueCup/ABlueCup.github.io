<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.lug.ustc.edu.cn/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="前端，学习笔记，积步堂" />





  <link rel="alternate" href="/rss.html" title="积步堂" type="application/atom+xml" />






<meta name="description" content="本片是对node基础概念的介绍">
<meta name="keywords" content="前端，积步堂，学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="NODE">
<meta property="og:url" content="https://abluecup.github.io/2020/04/26/NODE/index.html">
<meta property="og:site_name" content="积步堂">
<meta property="og:description" content="本片是对node基础概念的介绍">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://abluecup.github.io/2020/04/26/NODE/同步异步.png">
<meta property="og:image" content="https://abluecup.github.io/2020/04/26/NODE/Promise%20A+.png">
<meta property="og:image" content="https://abluecup.github.io/2020/04/26/NODE/页面通信.png">
<meta property="og:updated_time" content="2020-05-15T05:21:36.686Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="NODE">
<meta name="twitter:description" content="本片是对node基础概念的介绍">
<meta name="twitter:image" content="https://abluecup.github.io/2020/04/26/NODE/同步异步.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://abluecup.github.io/2020/04/26/NODE/"/>





  <title>NODE | 积步堂</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <a href="https://github.com/abluecup" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">积步堂</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">不积跬步，无以致千里；不积小流，无以成江海。</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-主页">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            主页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-关于">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-标签">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-分类">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-归档">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-日程">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br />
            
            日程
          </a>
        </li>
      
        
        <li class="menu-item menu-item-公益">
          <a href="/about/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益
          </a>
        </li>
      
        
        <li class="menu-item menu-item-友情链接">
          <a href="https://www.luciustan.online/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-link"></i> <br />
            
            友情链接
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://abluecup.github.io/2020/04/26/NODE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="卡而">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="积步堂">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">NODE</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-26T14:49:21+08:00">
                2020-04-26
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/04/26/NODE/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count gitment-comments-count" data-xid="/2020/04/26/NODE/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  9.1k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  37
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>本片是对node基础概念的介绍<br><a id="more"></a></p>
<h2 id="NODE介绍"><a href="#NODE介绍" class="headerlink" title="NODE介绍"></a>NODE介绍</h2><p>1.什么时node?<br>    基于V8引擎(谷歌浏览器的引擎)渲染JS的工具或者环境<br>    -&gt;安装NODE<br>    -&gt;把JS代码放到NODE环境中执行</p>
<p>2.安装NODE<br>NODE安装完成后，<br>-&gt; 当前电脑上自动安装了NPM(Node Package Manager：一个JS模块管理的工具)，基于NPM，可以安装下载JS模块(所有封装好可以供其他人调取使用的都可以称之为模块或者包)。<br>-&gt; 它会生成一个node执行命令(可以在DOS窗口或者终端命令中执行)：node xxx.js</p>
<p>3.如何在NODE中渲染和解析JS</p>
<ul>
<li>REPL(READ - EVALUATE - PRINT - LOOP， 输入-求值-输出-循环)</li>
<li>直接基于NODE来执行JS文件 </li>
</ul>
<p>4.之所以把NODE作为后台语言，是因为：<br>1）node可以安装在服务器上<br>2）我们可以把编写的JS代码放到服务器上，通过NODE来执行（我们可以使用JS来操作服务器，即使用JS来实现服务器端的一些功能操作。说NODE是后台语言，其实想表达的是JS是后台语言。所以JS是全栈编程语言）</p>
<p>5.NODE作后台的优势和特点<br>    传统后台语言： JAVA/PHP/PYTHON/GO/C#(.NET)/</p>
<ul>
<li>单线程的</li>
<li>基于V8引擎渲染：快</li>
<li>异步无阻塞的IO操作( IO: INPUT OUTPUT, 对文件的读写)</li>
<li>event-driven事件驱动，类似于发布订阅或者回调函数</li>
</ul>
<p>6.在vscode中开启node内置方法的代码提示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install -g typings</span><br><span class="line">在开发的项目中输入typings init, 当前目录下会出现typings.json的文件</span><br><span class="line"></span><br><span class="line">然后安装js插件的提示文件：：</span><br><span class="line"></span><br><span class="line">typings install dt~node --global--save 这个如果不行，可以使用 typings install @types/node --global --save</span><br></pre></td></tr></table></figure></p>
<h2 id="NPM的应用"><a href="#NPM的应用" class="headerlink" title="NPM的应用"></a>NPM的应用</h2><p>目前工程化开发/自动化开发（不一定是写后台），都是基于NODE环境，基于NPM管理模块，基于WEBPACK实现模块之间的依赖打包，部署上线。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm的常规命令：</span><br><span class="line">npm install xxx 把模块安装在当前目录下</span><br><span class="line">npm install xxx -global 把模块安装在全局目录下</span><br><span class="line">npm uninstall xxx</span><br><span class="line">npm uninstall xxx -g</span><br><span class="line">npm install xxx@xxx 安装指定版本号的模块</span><br><span class="line">npm view xxx&gt;xxx.version.txt 查看模块的版本号</span><br></pre></td></tr></table></figure></p>
<p>NPM的默认安装源 <a href="https://www.npmjs.com" target="_blank" rel="noopener">https://www.npmjs.com</a>, 在国内安装下载速度较慢，想要下载速度快些，我们可以做如下处理：<br>1.切换到淘宝镜像上<br>    安装CNPM，后期都是基于cnpm安装管理<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install cnpm -g</span><br><span class="line">cnpm install zepto</span><br></pre></td></tr></table></figure></p>
<pre><code>安装nrm切源工具，基于nrm把源切换到淘宝源上
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install nrm -g</span><br><span class="line">nrm ls 查看当前源</span><br><span class="line">nrm use xxx 使用某个源</span><br><span class="line">这样</span><br><span class="line">处理完成后，后期模块的管理依然基于npm即可</span><br></pre></td></tr></table></figure>
</code></pre><p>2，基于YARN安装：它也是模块管理工具，类似于NPM，但是安装管理的速度比NPM快好多<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install yarn -g</span><br><span class="line">yarn add xxx</span><br><span class="line">yarn remove xxxx</span><br><span class="line">使用yarn只能把模块安装在当前目录下，不能安装到全局环境下</span><br></pre></td></tr></table></figure></p>
<p>3，bower也是类似于npm的包管理器，只不过它是从github上下载<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install bower -g</span><br><span class="line">bower install xxx</span><br></pre></td></tr></table></figure></p>
<p>1.在本地项目中基于NPM/YARN安装第三方模块<br>第一步：在本地项目中创建一个package.json的文件<br>        作用：把当前项目中所有依赖的第三方模块信息(包含：模块名称以及版本号等信息)都记录下来，可以在这里配置一些可执行的命令脚本等；<br>        基于YARN安装会默认生成一个“配置清单”，只是信息没有手动创建的全面。<br>        npm init -y 或者 yarn init -y<br>        创建配置清单的时候，项目目录中不要出现中文和特殊符号，这样有可能识别不了。<br>第二步：安装<br>        开发依赖：只有在项目开发阶段以来的第三方模块 less webpack…<br>        生产依赖：项目部署实施的时候，也需要以来的第三方模块 jquery zepto…<br>        [npm]<br>            npm install xxx –save<br>                            –save-dev 保存到开发依赖中<br>        [yarn]<br>            yarn add xxx 默认就是保存到生产依赖中<br>                        –dev / -D  保存到开发依赖中<br>第三步：部署的时候跑环境<br>        不需要自己一个个的安装，只需要执行 npm install 或者 yarn install 即可，npm会自己先检测目录中是否有package.json文件，如果有的话，会按照文件中的配置清单依次安装。</p>
<p>== 开发一个项目，我们生成一个配置清单package.json, 当我们安装第三方模块使用的时候，把安装的模块信息记录到配置清单中，这样以后不管是团队协作开发还是项目部署上线，我们都没有必要把modules上传给别人，只需要把配置清单传递给其他人即可。其他人拿到配置清单，按照清单中的依赖项及版本号重新安装即可(重新安装：就叫“跑环境”)<br>package.json<br>{<br>  “name”: “node”,   模块名称<br>  “version”: “1.0.0”, 版本号<br>  “description”: “”,  描述<br>  “main”: “index.js”, 当前模块的主入口文件<br>  “scripts”: { //可执行脚本<br>    “test”: “echo \”Error: no test specified\” &amp;&amp; exit 1”<br>  },<br>  “keywords”: [],<br>  “author”: “”,<br>  “license”: “ISC”<br>  “dependencies”: {   生产依赖<br>    “jquery”: “^3.5.0”,<br>    “zepto”: “^1.2.0”<br>  }<br>   “devDependencies”: { 开发依赖<br>    “less”: “^3.11.1”<br>  }<br>}</p>
<p>2.安装在本地和全局的区别<br>安装在全局的特点：<br>    a. 所有的项目都可以使用这个模块(容易导致版本冲突，安装在全局的模块，不能基于CommonJS模块规范调取使用,即不能通过require调取使用)</p>
<p>安装在本地的特点：<br>    a. 只能当前项目使用这个模块(不能直接使用命令操作，安装在全局可以使用)</p>
<p>为什么安装在全局可以使用命令？<br>npm root / npm root -g  查看本地环境下或者全局环境下，NPM的安装目录<br>安装在全局目录下的模块，大部分都会生成一个xxx.cmd的文件，只要有这个文件，那么xxx就是一个可执行的命令。(例如yarn.cmd, yarn就是一个可执行的命令)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@IF EXIST &quot;%~dp0\node.exe&quot; (</span><br><span class="line">  &quot;%~dp0\node.exe&quot;  &quot;%~dp0\node_modules\yarn\bin\yarn.js&quot; %*</span><br><span class="line">) ELSE (</span><br><span class="line">  @SETLOCAL</span><br><span class="line">  @SET PATHEXT=%PATHEXT:;.JS;=;%</span><br><span class="line">  node  &quot;%~dp0\node_modules\yarn\bin\yarn.js&quot; %*</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>能否既安装在本地，也使用命令？<br>    可以，但是需要配置packagr.json中的<br>    1.把模块安装在本地，如果是支持命令操作的(会在node_modules中的bin中生成xxx.cmd的命令文件，只不过这个文件无法再全局下执行，不能直接使用命令)<br>    2.在package.json的scripts中配置需要执行的命令脚本<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">   &quot;kp&quot;:&quot;lessc --version&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>属性名自己设置即可，属性值是需要执行的命令脚本，根据需要自己编写(可以配置很多命令)
3.npm run kp / yarn kp 这样的操作就是把配置的脚本执行
    -&gt; 首先到配置清单的scripts中查找
    -&gt; 找到把后面对应的属性值执行
    -&gt; 执行脚本的时候，会到本地node_modules中的.bin文件查找，没有的话，再向NPM安装的全局目录下查找
</code></pre><h2 id="NODE入门"><a href="#NODE入门" class="headerlink" title="NODE入门"></a>NODE入门</h2><p>1.NODE本身是基于CommonJS模块规范设计的，所以模块是NODE的组成</p>
<pre><code>- 内置模块： NODE天生提供给JS调取使用的
- 第三方模块： 别人写好的，我们可以基于NPM安装使用
- 自定义模块： 自己创建的一些模块
</code></pre><p>CommonJS模块化设计思想 (AMD/CMD/ES6 MODULE都是模块化设计思想)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1.CommonJS规定，每一个JS文件都是一个单独的模块(模块是私有的，里面涉及的值和变量以及函数都是私有的，和其他JS文件是不冲突的)</span><br><span class="line">2.CommonJS中可以允许模块中的方法互相调用</span><br><span class="line">    B模块中想要调取A模块中的方法</span><br><span class="line">        -&gt; A导出</span><br><span class="line">        -&gt; B导入</span><br><span class="line">    [导出]</span><br><span class="line">        CommonJS给每一个模块都设置了内置的变量/属性/方法</span><br><span class="line">            module: 代表当前这个模块对象</span><br><span class="line">            module.exports: 模块的这个属性用来导出属性和方法</span><br><span class="line">            exports: 是内置的一个变量，也是用来导出当前模块的属性和方法的，虽然和module.exports不是一个东西，但是对应的值是同一个(modules.exports:exports, 值都是对象)</span><br><span class="line">    [导入]</span><br><span class="line">        require: CommonJS提供的内置变量，用来导入模块的(其实导入的就是module.exports导出的东西)，导入的值也是对象</span><br><span class="line"></span><br><span class="line">    exports.fn = fn; // 或者 module.exports.fn = fn</span><br><span class="line">    let temp1 = require(&apos;./temp1&apos;);  ./ 指当前目录中的某个模块，.js可以忽略</span><br><span class="line">                require导入的时候，首先把TEMP1中的代码自上而下执行，把exports对应的堆内存导入进来，所以接收到的结果是个对象。require是一个同步操作：只有把导入的模块代码执行完成，才可以获取值，然后继续执行本模块下面的代码</span><br><span class="line">                此时的temp1是一个对象&#123;fn:...&#125;</span><br><span class="line">    temp1.fn(2); 执行temp1中的fn方法</span><br></pre></td></tr></table></figure></p>
<p>特点：<br>    1.所有代码都运行在模块作用域，不会污染全局作用域。每一个模块都是私有的，包括里面所有的东西也都是私有的，和其他模块不会产生干扰；<br>    2.模块可以多次加载，但是只会在第一次加载时运行一次，然后运行结果就被缓存了，以后再加载，就直接读取缓存结果，想要让模块再次运行，必须清除缓存。(为了保证性能，减少模块代码重复执行的次数)<br>    3.模块加载的顺序，按照其在代码中出现的顺序。CommonJS规范加载模块是同步的，也就是说，只有加载完成，才能执行后面的操作。</p>
<p>exports={} 是无法导出内容的，默认和module.exports是同一个堆内存，但是这种操作让exoprts指向了新的堆内存，而module.exports不受影响， require导入的是module.exports对应的堆内存，而不是exports的</p>
<p>默认module.exports = exports， 所以我们在导出的时候，不能直接写module.exports={}或者exports={},这样会使两者指向的堆内存不同。</p>
<p>require 导入规则<br>    require(‘./xxx’); 查找当前目录下的自定义模块<br>    require(‘xxx’)首先到当前项目的node-module中查找是否存在这个模块，不存在着node提供的内置模块</p>
<p>_dirname: 模块中这个内置变量是当前所在的绝对路径<br>_filename: 包含绝对路径的文件名称 _dirname[a.js]</p>
<h2 id="内置模块"><a href="#内置模块" class="headerlink" title="内置模块"></a>内置模块</h2><h3 id="FS"><a href="#FS" class="headerlink" title="FS"></a>FS</h3><p>实现IO操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let fs = require(&apos;fs&apos;);</span><br><span class="line">1. fs.mkdir / fs.mkdirSync 创建目录, 有Sync的是同步创建，没有是异步。想要实现无阻塞，我们一般都使用异步操作完成要处理的事情。</span><br><span class="line">2. fs.readdir / fs.readdirSync: 读取文件目录中的内容, 返回的结果是一个数组</span><br><span class="line">3. fs.rmdir / fs.rmdirSync :删除目录，但是如果目录中有文件，无法删除，会报错</span><br><span class="line">4. fs.readFile: 读取文件中的内容</span><br><span class="line">5. fs.writeFile: 向文件中写入内容(覆盖式写入：原有的内容都没了)</span><br><span class="line">6. fs.appendFile: 追加写入内容，原有内容还在</span><br><span class="line">7. fs.copyFile: 复制文件到新的目录下</span><br><span class="line">8. fs.unlink: 删除文件</span><br></pre></td></tr></table></figure></p>
<h3 id="PATH"><a href="#PATH" class="headerlink" title="PATH"></a>PATH</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let path = require(&apos;path);</span><br><span class="line">path.resolve(); 返回当前的绝对地址(不包含模块名)</span><br><span class="line"></span><br><span class="line">path.resolve(__dirname, &apos;less/tt&apos;) 可以把一个相对路径拼接到绝对路径上，第一个参数是绝对路径，第二个是相对的，如果都是绝对路径，以后一个为主</span><br></pre></td></tr></table></figure>
<p>__dirname是当前模块所在的绝对路径，跟模块在哪里执行没有关系。<br>path.resolve() 当前模块中的方法在哪个模块中执行的，那么对应的绝对路径是执行模块的绝对路径。</p>
<h3 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h3><p>1, url.parse(url[, flag]) 把一个url地址进行解析，把地址中的每一部分按照对象键值对的方式存储起来，第二个参数默认是false，设置为true可以把?传参的部分也解析为键值对的方式<br>Url {<br>  protocol: ‘https:’,  协议<br>  slashes: true, 是否有双斜线<br>  auth: null,<br>  host: ‘<a href="http://www.zhufengpeixun.cn&#39;" target="_blank" rel="noopener">www.zhufengpeixun.cn&#39;</a>, 主机<br>  port: null, 端口<br>  hostname: ‘<a href="http://www.zhufengpeixun.cn&#39;" target="_blank" rel="noopener">www.zhufengpeixun.cn&#39;</a>, 域名<br>  hash: ‘#video’,哈希值<br>  search: ‘?form=qq&amp;lx=stu’, ？传参<br>  query: ‘form=qq&amp;lx=stu’, ?传参不包含?<br>  pathname: ‘/main/guide/index.html’, 请求的资源路径名称<br>  path: ‘/main/guide/index.html?form=qq&amp;lx=stu’,<br>  href:<br>   ‘<a href="https://www.zhufengpeixun.cn/main/guide/index.html?form=qq&amp;lx=stu#video&#39;" target="_blank" rel="noopener">https://www.zhufengpeixun.cn/main/guide/index.html?form=qq&amp;lx=stu#video&#39;</a><br>}</p>
<p>Url {<br>  protocol: ‘https:’,<br>  slashes: true,<br>  auth: null,<br>  host: ‘<a href="http://www.zhufengpeixun.cn&#39;" target="_blank" rel="noopener">www.zhufengpeixun.cn&#39;</a>,<br>  port: null,<br>  hostname: ‘<a href="http://www.zhufengpeixun.cn&#39;" target="_blank" rel="noopener">www.zhufengpeixun.cn&#39;</a>,<br>  hash: ‘#video’,<br>  search: ‘?form=qq&amp;lx=stu’,<br>  query: [Object: null prototype] { form: ‘qq’, lx: ‘stu’ }, // 区别就是query的值是一个对象<br>  pathname: ‘/main/guide/index.html’,<br>  path: ‘/main/guide/index.html?form=qq&amp;lx=stu’,<br>  href:<br>   ‘<a href="https://www.zhufengpeixun.cn/main/guide/index.html?form=qq&amp;lx=stu#video&#39;" target="_blank" rel="noopener">https://www.zhufengpeixun.cn/main/guide/index.html?form=qq&amp;lx=stu#video&#39;</a> }</p>
<h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><p>let server = http.createServer(); //创建服务<br>server.listen(); //监听端口</p>
<p>注意：基于NODE创建后台程序，我们一般都创建一个server模块，在模块当中实现创建WEB服务，和对于请求的处理(并且我们一般都会把server模块放在当前项目的根目录下)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">let http = require(&apos;http&apos;);</span><br><span class="line"></span><br><span class="line">// 创建WEB服务</span><br><span class="line">let server = http.createServer();</span><br><span class="line">server.listen(&apos;8989&apos;, ()=&gt;&#123;</span><br><span class="line">    // 服务创建成功，并且端口号已经监听成功后，触发的回调函数</span><br><span class="line">    console.log(&apos;server is successful, listen on 8989&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// listen EACCES 0.0.0.0:8989 这种错误是端口号被占用了，我们需要重新修改端口号</span><br><span class="line"></span><br><span class="line">// 当服务创建成功，命令行中会一直存在光标闪烁，证明服务器正在运行中(一定要保证服务是运行的), 按 ctrl + c 可以结束正在运行的服务</span><br><span class="line">// 客户端如何向服务端发送请求，</span><br><span class="line">//  对应协议、域名、端口号等信息，在浏览器中或者AJAX中发送请求即可</span><br><span class="line">// http://localhost:8686/... 服务在当前电脑上</span><br><span class="line">// http://ip:8989/..IP做域名访问，如果是内网IP，相同局域网下的用户可以访问这个服务，如果是外网IP,所有能联网的都可以访问这个服务， 局域网下访问需要互相关掉防火墙</span><br><span class="line">// 把请求的URL地址中：路径名称&amp;问号传参分别解析出来</span><br></pre></td></tr></table></figure>
<p>createServer((req, res)=&gt;{<br>    req: request 请求对象，包含了客户端请求的信息<br>        req.url 存储的是请求资源的路径地址及问号传参（没有哈希值）<br>        req.method 客户端请求方式<br>        req.headers 客户端的请求头信息，是一个对象<br>    res: response 相应对象，包含了一些属性和方法，可以让服务器端返回给客户端的内容<br>        res.write() 基于这个方法，服务器端可以向客户端返回内容<br>        res.end 结束响应<br>        res.writeHead 重写响应头信息<br>        。。。<br>})</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>),</span><br><span class="line">url = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">let</span> count=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> handle = <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> server = http.createServer(handle);</span><br><span class="line">server.listen(<span class="string">'8989'</span>, ()=&gt;&#123;</span><br><span class="line">    <span class="comment">// 服务创建成功，并且端口号已经监听成功后，触发的回调函数</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'server is successful, listen on 8989'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="创建静态资源服务器"><a href="#创建静态资源服务器" class="headerlink" title="创建静态资源服务器"></a>创建静态资源服务器</h2><p>服务器上有一堆代码，这对项目代码中即可能有服务器端的程序代码，也可能有客户端的程序代码，而客户端的程序代码我们一般都放到static这个目录下<br>static<br>    都是服务器端需要返回给客户端，由客户端浏览器渲染和解析的(前端项目：包括页面、CSS、JS、图片等)<br>server.js<br>    都是需要在服务器端基于NODE执行的(后端项目，一般只有JS)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">// let http = require(&apos;http&apos;),</span><br><span class="line">//     url = require(&apos;url&apos;);</span><br><span class="line">// let &#123; readFile &#125; = require(&apos;./utils/fsPromise&apos;);</span><br><span class="line">// let handle = function handle(req, res) &#123;</span><br><span class="line">//     //客户端请求资源文件(PATH-NAME),服务器端都是到STATIC这个目录下进行读取，根据客户端请求的路径名称，服务器端基于FS读取文件中内容的时候，直接加上./static即可</span><br><span class="line">//     let &#123; method, headers: requestHeaders &#125; = req,</span><br><span class="line">//         &#123; pathname, query &#125; = url.parse(req.url, true);</span><br><span class="line">//     readFile(`./static$&#123;pathname&#125;`).then(result =&gt; &#123;</span><br><span class="line">//         //读取成功，文件在</span><br><span class="line">//         res.writeHead(200);</span><br><span class="line">//         res.end(result);</span><br><span class="line">//     &#125;).catch(error =&gt; &#123;</span><br><span class="line">//         // 读取失败，文件不存在，客户端请求的地址是错误的，我们应该响应的内容是404</span><br><span class="line">//         res.writeHead(404,&#123;</span><br><span class="line">//             &apos;content-type&apos;:&apos;text/plain;charset=utf-8&apos;</span><br><span class="line">//         &#125;);</span><br><span class="line">//         res.end(&apos;NOT FOUND&apos;);</span><br><span class="line">//     &#125;);</span><br><span class="line">// &#125;</span><br><span class="line">// let server = http.createServer(handle);</span><br><span class="line">// server.listen(&apos;8989&apos;, () =&gt; &#123;</span><br><span class="line">//     // 服务创建成功，并且端口号已经监听成功后，触发的回调函数</span><br><span class="line">//     console.log(&apos;server is successful, listen on 8989&apos;);</span><br><span class="line">// &#125;);</span><br><span class="line"></span><br><span class="line">let http = require(&apos;http&apos;), url = require(&apos;url&apos;), mime = require(&apos;mime&apos;),</span><br><span class="line">    &#123; readFile &#125; = require(&apos;./utils/fsPromise&apos;)</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line">let handle = function handle(req, res) &#123;</span><br><span class="line">    let &#123; pathname, query &#125; = url.parse(req.url, true),</span><br><span class="line">    pathREG = /\.([a-zA-Z0-9]+)$/i; //捕获后缀名的正则</span><br><span class="line">    readFile(`./static$&#123;pathname&#125;`).then(result =&gt; &#123;</span><br><span class="line">        //根据请求资源的文件类型，设置相应内容的MIME(多用途互联网扩展类型)</span><br><span class="line">        //</span><br><span class="line">        let suffix = pathREG.exec(pathname)[1];</span><br><span class="line">        res.writeHead(200, &#123;</span><br><span class="line">            &apos;content-type&apos;: `$&#123;mime.getType(suffix)&#125;;charset=utf-8`</span><br><span class="line">        &#125;);</span><br><span class="line">        res.end(result);</span><br><span class="line">    &#125;).catch(error =&gt; &#123;</span><br><span class="line">        res.writeHead(404, &#123;</span><br><span class="line">            &apos;content-type&apos;: `text/plain;charset=utf-8`</span><br><span class="line">        &#125;);</span><br><span class="line">        res.end(&apos;NOT FOUND&apos;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">http.createServer(handle).listen(8989, () =&gt; &#123;</span><br><span class="line">    console.log(&quot;server is successful&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>我们创建的WEB服务需要处理两类请求<br>1.静态资源文件的请求处理：想要文件<br>2.API接口的请求处理，想要数据<br>区别：第一类请求的地址中有后缀名，第二类没有</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>), url = <span class="built_in">require</span>(<span class="string">'url'</span>), mime = <span class="built_in">require</span>(<span class="string">'mime'</span>), qs = <span class="built_in">require</span>(<span class="string">'qs'</span>),</span><br><span class="line">    &#123; readFile, writeFile &#125; = <span class="built_in">require</span>(<span class="string">'./utils/fsPromise'</span>)</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"><span class="comment">// 公共方法</span></span><br><span class="line"><span class="keyword">let</span> responseResult = <span class="function"><span class="keyword">function</span> <span class="title">responseResult</span>(<span class="params">res, returnVal</span>) </span>&#123;</span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">        <span class="string">'content-type'</span>: <span class="string">'application/json;charset=utf-8;'</span></span><br><span class="line">    &#125;);</span><br><span class="line">    res.end(<span class="built_in">JSON</span>.stringify(returnVal));</span><br><span class="line">&#125;</span><br><span class="line">    ; <span class="keyword">let</span> readUser = <span class="function"><span class="keyword">function</span> <span class="title">readUser</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> readFile(<span class="string">'./json/USER.JSON'</span>).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(result);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    ; <span class="keyword">let</span> readVote = <span class="function"><span class="keyword">function</span> <span class="title">readVote</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> readFile(<span class="string">'./json/VOTE.JSON'</span>).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(result);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">let</span> handle = <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; pathname, query &#125; = url.parse(req.url, <span class="literal">true</span>),</span><br><span class="line">        pathREG = <span class="regexp">/\.([a-zA-Z0-9]+)$/i</span>; <span class="comment">//捕获后缀名的正则</span></span><br><span class="line">    <span class="keyword">if</span> (pathREG.test(pathname)) &#123;</span><br><span class="line">        <span class="comment">//静态资源处理</span></span><br><span class="line">        readFile(<span class="string">`./static<span class="subst">$&#123;pathname&#125;</span>`</span>).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//根据请求资源的文件类型，设置相应内容的MIME(多用途互联网扩展类型)</span></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            <span class="keyword">let</span> suffix = pathREG.exec(pathname)[<span class="number">1</span>];</span><br><span class="line">            res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">                <span class="string">'content-type'</span>: <span class="string">`<span class="subst">$&#123;mime.getType(suffix)&#125;</span>;charset=utf-8`</span></span><br><span class="line">            &#125;);</span><br><span class="line">            res.end(result);</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            res.writeHead(<span class="number">404</span>, &#123;</span><br><span class="line">                <span class="string">'content-type'</span>: <span class="string">`text/plain;charset=utf-8`</span></span><br><span class="line">            &#125;);</span><br><span class="line">            res.end(<span class="string">'NOT FOUND'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// API接口请求处理</span></span><br><span class="line">    <span class="comment">//GET-USER:根据传递的ID获取指定的用户信息</span></span><br><span class="line">    <span class="keyword">if</span> (pathname === <span class="string">'/getUser'</span> &amp;&amp; req.method === <span class="string">'GET'</span>) &#123;</span><br><span class="line">        <span class="comment">//传递的信息都在QUERY中存储着</span></span><br><span class="line">        <span class="keyword">let</span> &#123; userId = <span class="number">0</span> &#125; = query,</span><br><span class="line">            returnVal = &#123; <span class="attr">code</span>: <span class="number">1</span>, <span class="attr">message</span>: <span class="string">'no match any data'</span>, <span class="attr">data</span>: <span class="literal">null</span> &#125;;</span><br><span class="line">        readUser().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> data = result.find(<span class="function"><span class="params">item</span> =&gt;</span> <span class="built_in">parseFloat</span>(item[<span class="string">'id'</span>]) === <span class="built_in">parseFloat</span>(userId));</span><br><span class="line">            <span class="keyword">if</span> (data) &#123;</span><br><span class="line">                returnVal = &#123; <span class="attr">code</span>: <span class="number">0</span>, <span class="attr">message</span>: <span class="string">'ok'</span>, data &#125;;</span><br><span class="line">                responseResult(res, returnVal);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">''</span>); <span class="comment">//没有数据的时候，让其执行CATCH中的操作，这样我们只需要让THEN中的方法中有异常信息即可</span></span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> responseResult(res, returnVal));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//注册数据</span></span><br><span class="line">    <span class="keyword">if</span> (pathname === <span class="string">'/register'</span> &amp;&amp; req.method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">        <span class="comment">//接收客户端请求主体传递的内容, ondata:正在接收请求主题内容，可能会被触发执行很多次</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> pass = <span class="string">``</span>;</span><br><span class="line">        req.on(<span class="string">'data'</span>, chunk =&gt; &#123;</span><br><span class="line">            <span class="comment">//chunk获取的都是本次接收的BUFFER格式的数据 ‘’+chunk会转化成字符串</span></span><br><span class="line">            pass += chunk;            </span><br><span class="line">        &#125;);</span><br><span class="line">        req.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">            <span class="comment">//请求主体内容已经接收完了,pass是一个urlencoded的字符串，我们需要把它解析为对象            </span></span><br><span class="line">            pass = qs.parse(pass);            </span><br><span class="line">            readUser().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// FORMAT-PASS 格式化pass数据</span></span><br><span class="line">                <span class="keyword">let</span> maxId = result.length &lt;= <span class="number">0</span> ? <span class="number">0</span> : <span class="built_in">parseFloat</span>(result.length<span class="number">-1</span>); </span><br><span class="line">                pass.password = pass.password.substr(<span class="number">4</span>, <span class="number">24</span>).split(<span class="string">''</span>).reverse().join(<span class="string">''</span>);</span><br><span class="line">                <span class="keyword">let</span> newData = &#123;</span><br><span class="line">                    id: maxId++,</span><br><span class="line">                    name: <span class="string">''</span>,</span><br><span class="line">                    picture: <span class="string">`img/<span class="subst">$&#123;pass.sex == <span class="number">0</span> ? <span class="string">`man`</span> : <span class="string">`woman`</span>&#125;</span>.png`</span>,</span><br><span class="line">                    phone: <span class="string">""</span>,</span><br><span class="line">                    sex: <span class="number">0</span>,</span><br><span class="line">                    password: <span class="string">""</span>,</span><br><span class="line">                    bio: <span class="string">""</span>,</span><br><span class="line">                    time: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(),</span><br><span class="line">                    isMatch: <span class="number">0</span>,</span><br><span class="line">                    matchId: <span class="string">"000"</span>,</span><br><span class="line">                    slogan: <span class="string">""</span>,</span><br><span class="line">                    voteNum: <span class="number">0</span>,</span><br><span class="line">                    ...pass <span class="comment">//展开运算符覆盖原有的项</span></span><br><span class="line">                &#125;;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">//把NEWDATA追加到RESULT末尾</span></span><br><span class="line">                result.push(newData);</span><br><span class="line">                <span class="keyword">return</span> writeFile(<span class="string">'./json/USER.JSON'</span>, result);</span><br><span class="line">            &#125;).then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">                responseResult(res,</span><br><span class="line">                    &#123; <span class="attr">code</span>: <span class="number">0</span>, <span class="attr">message</span>: <span class="string">'ok'</span> &#125;</span><br><span class="line">                );</span><br><span class="line">            &#125;)</span><br><span class="line">                .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(error); <span class="comment">//展示错误信息</span></span><br><span class="line">                    responseResult(res, &#123; <span class="attr">code</span>: <span class="number">1</span>, <span class="attr">message</span>: <span class="string">'no'</span> &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//请求的都不是以上接口</span></span><br><span class="line">    res.writeHead(<span class="number">404</span>);</span><br><span class="line">    res.end(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">http.createServer(handle).listen(<span class="number">8989</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"server is successful"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="JS中的同步异步编程"><a href="#JS中的同步异步编程" class="headerlink" title="JS中的同步异步编程"></a>JS中的同步异步编程</h2><blockquote>
<p>浏览器是多线程的，JS是单线程的，(因为浏览器只分配一个线程来执行JS).<br>进程大线程小，一个进程中包含多个线程，例如在浏览器中打开一个HTML页面，就占用了一个进程。加载页面的时候浏览器分配一个线程去计算DOM结构，分配其他的线程去加载对应的资源文件，。。。再分配一个线程去自上而下执行JS</p>
</blockquote>
<p>同步：在一个线程上(主栈|主任务队列)，同一个时间只能做一件事情，当前事情完成才能进行下一个事情(先把一个任务进栈执行，执行完出栈，再把下一个任务进栈……)</p>
<p>异步：在主栈中执行一个任务，但是发现这个任务是一个异步的操作,我们会把它移出主栈，放到等待任务队列中(此时浏览器会分配其他线程监听异步任务是否到达指定的执行时间)。如果主栈执行完，监听者会把到达时间的异步任务重新放到主栈中执行……</p>
<ul>
<li>定时器</li>
<li>事件绑定</li>
<li>AJAX</li>
<li>回调函数</li>
<li>progress.nextTick</li>
<li>Promise(async/await)</li>
<li>node中fs可以进行异步的I/O操作</li>
</ul>
<p>所以JS中的异步编程仅仅是根据某些机制来管控任务的执行顺序，不存在同时执行两个任务这一说法。<br><img src="/2020/04/26/NODE/同步异步.png" alt="同步异步图示"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// new Promise的时候会立即把Excutor函数(也就是传递的回调函数)执行，所以Promise本身可以认为是同步的</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">    resolve(); <span class="comment">//执行resolve, 会把之前基于THEN存放的方法执行</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//执行完成Excutor，紧接着执行then，执行then的时候会把传递的回调函数放到指定的容器中等待触发自行</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">    </span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">4</span>);</span><br><span class="line"><span class="comment">// 1 ，2 ，4 ，3</span></span><br></pre></td></tr></table></figure>
<p>Promise并不是完全同步的，挡在Excutor中执行resolve或者reject的时候，此时是异步操作，会先执行then/catch等，当主栈完成后，才会再去掉用resolve/reject，把存放的方法执行<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ES7中新增加对PROMISE操作的新语法： async/await(使用await必须保证当前方法是基于async修饰的)</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AA</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>); </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">Math</span>.random() &lt; <span class="number">0.5</span> ? reject(<span class="number">100</span>) : resolve(<span class="number">200</span>);</span><br><span class="line">        &#125;, <span class="number">0</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>); </span><br><span class="line">    <span class="keyword">let</span> res = <span class="keyword">await</span> AA(); <span class="comment">//先把AA执行，等待AA中的PROMISE完成(无论成功失败)，把最后的处理结果获取到，赋值给res,拿到后再执行后面的代码，(有人说await是把异步的操作同步化？)</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>);  </span><br><span class="line">&#125;</span><br><span class="line">fn();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2, 1, 4,3 await并不是同步，</span></span><br><span class="line"><span class="comment">// 1,先把AA执行，返回一个PROMISE</span></span><br><span class="line"><span class="comment">// 2, 它会暂时跳出正在执行的函数，也就是await后面的代码暂时先不执行(把后面的代码从主栈中移除，放到等待区域中)</span></span><br><span class="line"><span class="comment">// 3， 主栈空闲，执行后面的任务</span></span><br><span class="line"><span class="comment">// 4， 当主栈中的其他任务执行完成，主栈空闲，并且AA中的PROMISE也已经计算完成最后的结果，再把之前第二步移到等待区域的内容，重新拿回到主栈中去执行</span></span><br></pre></td></tr></table></figure></p>
<h3 id="宏任务-macro-task-amp-微任务-micro-task"><a href="#宏任务-macro-task-amp-微任务-micro-task" class="headerlink" title="宏任务(macro task) &amp; 微任务(micro task)"></a>宏任务(macro task) &amp; 微任务(micro task)</h3><p>宏任务(macro task)</p>
<ul>
<li>定时器</li>
<li>事件绑定</li>
<li>AJAX</li>
<li>回调函数</li>
<li>node中fs可以进行异步的I/O操作</li>
</ul>
<p>微任务(micro task)</p>
<ul>
<li>progress.nextTick</li>
<li>Promise(async/await)</li>
</ul>
<p>执行顺序<br>SYNC =&gt; MICRO =&gt; MACRO<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'async1 start'</span>);</span><br><span class="line">    <span class="keyword">await</span> async2();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'async1 end'</span>); <span class="comment">// 等待队列2，</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'async2'</span>);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'script start'</span>);</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'setTimeout'</span>);  <span class="comment">// 等待队列 1，</span></span><br><span class="line">    </span><br><span class="line">&#125;,<span class="number">0</span>);</span><br><span class="line">async1();</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'promise1'</span>);</span><br><span class="line">    resolve();</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'promise2'</span>); <span class="comment">// 等待队列3</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'script end'</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * script start </span></span><br><span class="line"><span class="comment"> * async1 start</span></span><br><span class="line"><span class="comment"> * async2</span></span><br><span class="line"><span class="comment"> * promise1</span></span><br><span class="line"><span class="comment"> * script end</span></span><br><span class="line"><span class="comment"> * promise2 | async1 end 它们的顺序根据不同的V8版本，顺序是不一样的</span></span><br><span class="line"><span class="comment"> * setTimeout</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure></p>
<h3 id="node中独有的异步操作API"><a href="#node中独有的异步操作API" class="headerlink" title="node中独有的异步操作API"></a>node中独有的异步操作API</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(()=&gt;&#123;</span><br><span class="line">    //也是定时器，但是不设置时间，也是异步编程(宏任务),它会在其他定时器之前执行(现在又改了，)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">setTimeout(()=&gt;&#123;</span><br><span class="line">    console.log(1);</span><br><span class="line">    </span><br><span class="line">&#125;,0);</span><br><span class="line">setImmediate(()=&gt;&#123;</span><br><span class="line">    console.log(2);</span><br><span class="line">    </span><br><span class="line">&#125;);</span><br><span class="line">// 2，1 现在跟其他定时器一样了，相当于后面没写0</span><br></pre></td></tr></table></figure>
<p>process.nextTick<br>把当前任务放到主栈的最后执行,并不是放在等待区<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">&#125;,<span class="number">10</span>);</span><br><span class="line">process.nextTick(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>); </span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3,2,1</span></span><br></pre></td></tr></table></figure></p>
<p>progress.env.NODE_ENV<br>全局环境变量，<br>用途：真实项目中我们基于WBEPACK打包配置的时候，往往需要区分不同环境下的不同操作，例如有开发环境，测试环境，生产环境……，而我们一般都是基于环境变量来区分打包配置的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;script&quot;:&#123;</span><br><span class="line">        &quot;dev&quot;:&quot;cross-env NODE_ENV = dev node index.js&quot;, // 兼容、设置环境变量、执行index.js</span><br><span class="line">        &quot;pro&quot;:&quot;cross-env NODE_ENV = dev node index.js&quot;,</span><br><span class="line">        &quot;test&quot;:&quot;cross-env NODE_ENV = dev node index.js&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">安装cross-env模块，以兼容于windows系统</span><br></pre></td></tr></table></figure></p>
<h2 id="Promise-A"><a href="#Promise-A" class="headerlink" title="Promise A+"></a>Promise A+</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">new Promise((resolve, reject)=&gt;&#123;</span><br><span class="line">    // RESOLVE &amp; REJECT 是自己任意执行的，但是大家约定成功执行RESOLVE, 失败执行REJECT</span><br><span class="line">    // EXCUTOR函数(执行函数)中，可以不管控异步操作(但是不管控异步，没有意义，一般都需要管控)</span><br><span class="line">    resolve(100);</span><br><span class="line">&#125;).then(result=&gt;&#123;</span><br><span class="line">    //RESOLVE执行的时候会触发第一个回调函数</span><br><span class="line">    console.log(1);</span><br><span class="line">    return 100;//会把这个值传递给下一个THEN,如果返回的是PROMISE，则等到PROMISE处理完成，把处理完成的结果传递给下一个THEN</span><br><span class="line">&#125;, reason=&gt;&#123;</span><br><span class="line">  //REJECT执行的时候会触发第二个回调函数  </span><br><span class="line">  console.log(2);</span><br><span class="line">  </span><br><span class="line">&#125;).then(result=&gt;&#123;</span><br><span class="line">    //需要保证执行THEN方法返回的依然是PROMISE实例，这样才可以实现链式调用</span><br><span class="line">    //上一个THEN中管控的两个方法只要任何一个不报错，都会执行这个THEN方法，如果报错，会执行此THEN中的第二个回调函数</span><br><span class="line">&#125;).catch(reason=&gt;&#123;</span><br><span class="line">    //相当于THEN中的第二个方法</span><br><span class="line">&#125;);</span><br><span class="line">console.log(3);</span><br><span class="line">Promise.all([Promise1, Promise2,...]).then(res=&gt;&#123;</span><br><span class="line">    //等待所有的PROMISE都成功，执行THEN，反之只有有一个失败就执行CATCH</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/04/26/NODE/Promise A+.png" alt="promise"></p>
<h3 id="Promise的封装"><a href="#Promise的封装" class="headerlink" title="Promise的封装"></a>Promise的封装</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Promise</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(excutorCallback) &#123;</span><br><span class="line">        <span class="keyword">this</span>.status = <span class="string">'pending'</span>;</span><br><span class="line">        <span class="keyword">this</span>.value = <span class="literal">undefined</span>;</span><br><span class="line">        <span class="keyword">this</span>.fulfilledAry = [];</span><br><span class="line">        <span class="keyword">this</span>.rejectedAry = [];</span><br><span class="line">        <span class="comment">//执行</span></span><br><span class="line">        <span class="keyword">let</span> resolveFn = <span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                clearTimeout(timer);</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.status !== <span class="string">'pending'</span>) <span class="keyword">return</span>;</span><br><span class="line">                <span class="keyword">this</span>.status = <span class="string">'fulfilled'</span>;<span class="comment">// 当前状态成功</span></span><br><span class="line">                <span class="keyword">this</span>.value = result;</span><br><span class="line">                <span class="keyword">this</span>.fulfilledAry.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                    item(<span class="keyword">this</span>.value);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> rejectFn = <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                clearTimeout(timer);</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.status !== <span class="string">'pending'</span>) <span class="keyword">return</span>;</span><br><span class="line">                <span class="keyword">this</span>.status = <span class="string">'rejected'</span>;<span class="comment">// 当前状态失败</span></span><br><span class="line">                <span class="keyword">this</span>.value = reason;</span><br><span class="line">                <span class="keyword">this</span>.rejectedAry.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">                    item(<span class="keyword">this</span>.value);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            excutorCallback(resolveFn, rejectFn);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            <span class="comment">//有异常信息按照REJECT状态处理</span></span><br><span class="line">            rejectFn(err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//执行THEN返回一个新的PROMISE实例</span></span><br><span class="line">    then(fulfilledCallback, rejectedCallback) &#123;</span><br><span class="line">        <span class="keyword">typeof</span> fulfilledCallback !== <span class="string">'function'</span> ? fulfilledCallback = <span class="function"><span class="params">result</span> =&gt;</span> result : <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">typeof</span> rejectedCallback !== <span class="string">'function'</span> ? rejectedCallback = <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(reason <span class="keyword">instanceof</span> <span class="built_in">Error</span> ? reason.message: reason);</span><br><span class="line">        &#125; : <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.fulfilledAry.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">let</span> x = fulfilledCallback(<span class="keyword">this</span>.value);</span><br><span class="line">                    x <span class="keyword">instanceof</span> <span class="built_in">Promise</span> ? x.then(resolve, reject) : resolve(x);</span><br><span class="line">                    resolve(x);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    reject(err);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">this</span>.rejectedAry.push(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">let</span> x = rejectedCallback(<span class="keyword">this</span>.value);</span><br><span class="line">                    <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</span><br><span class="line">                        x.then(resolve, reject);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    reject(x);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    reject(err);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">catch</span>(rejectedCallback) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.then(<span class="literal">null</span>, rejectedCallback);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Promise.all([]).then(res=&gt;&#123;所有的都成功走这里，res中存储了每一个实例返回的结果，而且和数组的顺序是一样的&#125;).catch(()=&gt;&#123;只要有一个失败就执行这个，失败后不再执行后面的操作&#125;)</span></span><br><span class="line">    <span class="keyword">static</span> all(promiseAry = []) &#123; <span class="comment">//添加私有属性</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//循环数组中的每一项</span></span><br><span class="line">            <span class="keyword">let</span> count = <span class="number">0</span>, result = [], step = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// count记录成功的数量，result记录成功的结果,step记录处理的个数</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promiseAry.length; i++) &#123;</span><br><span class="line">                <span class="comment">// promiseAry[i], 每一个需要处理的promise实例</span></span><br><span class="line">                promiseAry[i].then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                    count++;</span><br><span class="line">                    result[i] = val; <span class="comment">//索引需要和promiseAry一一对应，保证结果的顺序</span></span><br><span class="line">                    <span class="keyword">if</span> (count === promiseAry.length) &#123;</span><br><span class="line">                        resolve(result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, reason =&gt; &#123;</span><br><span class="line">                    reject(reason);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="built_in">Promise</span>;</span><br></pre></td></tr></table></figure>
<h2 id="本地存储-amp-服务器存储"><a href="#本地存储-amp-服务器存储" class="headerlink" title="本地存储 &amp; 服务器存储"></a>本地存储 &amp; 服务器存储</h2><p>本地存储：把一些信息存储到客户端本地(主要目的有很多，其中有一个实现多页面之间的信息共享)</p>
<pre><code>-&gt; manifest 离线缓存 H5处理离线缓存还是不够完善，所以真实项目中一般还是传统的NATIVE APP来完成这件事
-&gt; LocalStorage / SessionStorage H5中新增加的API，基于这个API可以把一些数据缓存到本地(常用)
-&gt; IndexDB / webSQL: 本地数据库存储
-&gt; Cookie 本地信息存储(常用)
-&gt; CacheStorage / ApplicationCache  本地缓存存储
...
</code></pre><p>用到本地存储的地方：<br>    【页面通信】页面之间信息的通信<br>        A存信息，B页面可以获取<br>        登录<br>        记住用户名密码<br>        购物车<br>        跳转到其他页面，返回上级页面的时候停留在之前最后一次点击的位置<br>        …<br>    <img src="/2020/04/26/NODE/页面通信.png" alt="页面通信"><br>    【做一些性能优化】<br>        把一些不经常改变的数据，在第一次从服务器端获取到之后，存储到客户端本地，(记录一个存储时间，假设我们设置有效存储时间是10分钟，那么十分钟以内，我们再刷新页面就不用再向服务器发请求了，直接从本地数据中获取展示即可，超过十分钟，重新向服务器发送请求，请求回来的数据参考第一次，也一样存储到本地<br>            ，减轻服务器压力<br>            ，对于不经常更新的数据我们可以把存储周期设置的长一点，有助于页面的第二次加载的时候，渲染的速度变快(移动端经常做这些事情)<br>        )</p>
<h3 id="LocalStorage-amp-Cookie"><a href="#LocalStorage-amp-Cookie" class="headerlink" title="LocalStorage &amp; Cookie"></a>LocalStorage &amp; Cookie</h3><p>[cookie]<br>    1, 兼容所有浏览器<br>    2，有存储的大小限制，一般一个源(域)下，只能存储4KB内容<br>    3，cookie有过期时间，当然我们自己可以手动设置这个时间<br>    4, 杀毒软件都可能会把cookie信息强制清除掉<br>    5，在隐身模式下，是不记录cookie<br>    6，cookie不是严格的本地存储，因为要和服务器之间来回传输<br>[localstorage]<br>    1, 不兼容IE低版本(IE8及以下)<br>    2，也有存储的大小限制，一个源下最多存储5MB<br>    3，本地永久存储，只要不是手动删除，就永远存储在本地(但是我们可以基于API： removeItem/clear 手动清除一些自己想要删除的信息)<br>    4，杀毒软件暂时不会清除localstorage(新版本谷歌浏览器会清除storage)<br>    5, 在隐身模式下，是记录localstorage的<br>    6，localstorage和服务器没有关系</p>
<p>真实项目中使用本地存储来完成一些需求的情况不是很多，一般都是基于服务器的session或者数据库存储完成的(服务器的session和本地的cookie是有关联的)，如果不考虑兼容，想基于本地存储来完成一些事情，那么一般都是用localstorage的(尤其是移动端开发)</p>
<p>localStorage.setItem([key],[value]); value必须是字符串格式的(即使写的不是字符串，也会默认转换成字符串)<br>localStorage.getItem([key]); 通过属性名获取存储的信息<br>localStorage.removeItem([key]); 删除指定的存储信息<br>localStorage.clear(); 清除当前域下存储的所有信息<br>localStorage.key([index]); 基于索引获取指定的KEY名</p>
<p>document.cookie=’’; // 设置cookie</p>
<h2 id="Express"><a href="#Express" class="headerlink" title="Express"></a>Express</h2><p>参考文档 <a href="https://www.expressjs.com.cn/4x/api.html" target="_blank" rel="noopener">https://www.expressjs.com.cn/4x/api.html</a></p>
<h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><p>EXPRESS里面的中间件是在API接口请求处理之前，把一些公共的部分进行提取，中间件中就是先处理这些公共的内容，处理完成后，再继续执行接口请求即可<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.use(); <span class="comment">//使用中间件</span></span><br><span class="line">app.use(<span class="string">'/xxx'</span>, (req, res, next)=&gt;&#123;</span><br><span class="line">    <span class="comment">//请求的PATH地址中是以/user开头的，例如： '/user', '/user/add'...</span></span><br><span class="line"></span><br><span class="line">    next(); <span class="comment">//不执行NEXT是无法走到下一个中间件或请求中的,(next就是执行下一个)</span></span><br><span class="line">&#125;)</span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//所有的请求都会走这个中间件，而且中间件执行的顺序是按照书写的先后顺序执行</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>),</span><br><span class="line">    bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>),</span><br><span class="line">    session = <span class="built_in">require</span>(<span class="string">'express-session'</span>),</span><br><span class="line">    app = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> port = <span class="number">8686</span>;</span><br><span class="line">app.listen(port, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Server is successful on <span class="subst">$&#123;port&#125;</span>!`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//静态资源文件处理</span></span><br><span class="line">app.use(express.static(<span class="string">'./static'</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//API处理</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// body-parse，如果是POST/PUT请求，会把基于请求主体传递的信息预先截获</span></span><br><span class="line"><span class="comment">// 如果传递的是JSON格式的字符串，基于bodyParser.json()会把它转换为JSON格式的对象</span></span><br><span class="line"><span class="comment">// 如果传递的是URL-ENCODED格式的字符串，会基于bodyParser.urlencoded()把它转换为对象键值对的方式</span></span><br><span class="line"><span class="comment">//。。。</span></span><br><span class="line"><span class="comment">// 把转换后的结果挂载在req.body属性上</span></span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// EXPRESS-SESSION这个中间件是供我们后续操作SESSION的，基于这个中间件，我们可以设置客户端COOKIE的过期时间，也即SESSION在服务器存储的时间，当中间件执行完成后，会在REQ上挂载一个SESSION的属性，用来操作SESSION</span></span><br><span class="line">app.use(session(&#123;</span><br><span class="line">    secret: <span class="string">'zfpx'</span>,</span><br><span class="line">    saveUninitialized: <span class="literal">false</span>,</span><br><span class="line">    resave: <span class="literal">false</span>,</span><br><span class="line">    cookie: &#123; <span class="attr">maxAge</span>: <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">30</span> &#125;</span><br><span class="line">&#125;));</span><br><span class="line">app.get(<span class="string">'/getUser'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当客户端向浏览器发送请求，如果请求方式是GET，请求路径是/getUser，就会把回调函数执行，里面有三个参数，req, res, next</span></span><br><span class="line"><span class="comment">     * req:request 它不是我们之前原生NODE中的REQ,它是EXPRESS框架封装处理的，但是也存储了很多客户端传递信息的对象</span></span><br><span class="line"><span class="comment">     *      REQ.PARAMS 存储了路径参数信息</span></span><br><span class="line"><span class="comment">     *      REQ.PATH 请求的路径名称</span></span><br><span class="line"><span class="comment">     *      REQ.QUERY 请求的问号传参(对象) GET请求一般都是这样传递信息的</span></span><br><span class="line"><span class="comment">     *      REQ.BODY  当请求的方式是BODY，我们基于BODY-PARSER中间件处理后，会把客户端请求主体中传递的内容存放到BODY属性上</span></span><br><span class="line"><span class="comment">     *      REQ.SEESSION 当我们基于EXPRESS-SESSION中间件处理后，会把SESSION操作放到这个属性上，基于这个属性可以操作SESSION信息</span></span><br><span class="line"><span class="comment">     *      REQ.COOKIES 当我们基于COOKIE-PARSER中间件处理以后，会把客户端传递的COOKIE信息存放到这个属性上</span></span><br><span class="line"><span class="comment">     *      REQ.GET()  获取指定的请求头信息</span></span><br><span class="line"><span class="comment">     *      REQ.PARAM() 基于这个方法，可以把URL-ENCODED格式字符串(或者路径参数)中的某一个属性名对应的信息获取到</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * res:response 也不是原生NODE中的RES,也是EXPRESS框架封装处理的，目的是为了提供一些属性和方法可以供服务器端向客户端返回内容</span></span><br><span class="line"><span class="comment">     *      RES.COOKIE() 通过此方法可以设置一些cookie信息，通过响应头set-cookie返回给客户端，客户端把返回的cookie信息种到本地</span></span><br><span class="line"><span class="comment">     *      RES.TYPE() 设置响应内容的mime类型</span></span><br><span class="line"><span class="comment">     *      RES.STATUS() 设置响应状态码</span></span><br><span class="line"><span class="comment">     *      RES.SET() 设置响应头</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     *      </span></span><br><span class="line"><span class="comment">     *      RES.REDIRECT() 响应是重定向的，状态码是302</span></span><br><span class="line"><span class="comment">     *      RES.RENDER() 只有页面是需要服务器渲染的时候，我们才会用这个</span></span><br><span class="line"><span class="comment">     *      </span></span><br><span class="line"><span class="comment">     *     </span></span><br><span class="line"><span class="comment">     *      RES.JSON(), 向客户端返回json格式的字符串，但是允许我们传递JSON格式对象，方法会帮我们转化为字符串然后返回(执行此方法后会自动结束响应，也就是执行了res.end)</span></span><br><span class="line"><span class="comment">     *      RES.SEND-STATUS() 结束响应，把状态对应的信息当作响应主体返回，我们一般都用status()，然后自己设置响应主体内容</span></span><br><span class="line"><span class="comment">     *      RES.SEND-FILE([PATH]) 首先把PATH指定的文件内容得到，然后把内容返回给客户端浏览器(完成了文件读取和响应两步操作)，也会自动结束响应</span></span><br><span class="line"><span class="comment">     *      RES.SEND() 你想返回啥随便(综合体)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">console</span>.log(req.body);</span><br><span class="line"></span><br><span class="line">    res.send(&#123;</span><br><span class="line">        message: <span class="string">'ok'</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">app.post(<span class="string">'/register'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="comment">// GET请求接收问号传参的信息，可以使用 REQ.QUERY / REQ.PARAM()</span></span><br><span class="line">    <span class="comment">// POST请求，接收请求主体传递的信息，此时我们需要使用一个中间件body-parser</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// req.body 获取的是请求主体的内容</span></span><br><span class="line">    <span class="built_in">console</span>.log();</span><br><span class="line"></span><br><span class="line">    req.session.xxx = <span class="string">'xxx'</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(req.session.xxx); <span class="comment">//获取SESSION</span></span><br><span class="line">    </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
      
    </div>
    
    
    
    
    <div>
        
            <div>

<div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>

</div>
        
    </div>

    

    

    
    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/04/23/Git/" rel="next" title="Git">
                <i class="fa fa-chevron-left"></i> Git
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/06/09/vue/" rel="prev" title="vue">
                vue <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      
        <div onclick="showGitment()" id="gitment-display-button">显示 Gitment 评论</div>
        <div id="gitment-container" style="display:none"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">卡而</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">32</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/rss.html" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/abluecup/" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:2946358527@qq.com" target="_blank" title="邮箱">
                      
                        <i class="fa fa-fw fa-envelope"></i></a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#NODE介绍"><span class="nav-number">1.</span> <span class="nav-text">NODE介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NPM的应用"><span class="nav-number">2.</span> <span class="nav-text">NPM的应用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NODE入门"><span class="nav-number">3.</span> <span class="nav-text">NODE入门</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内置模块"><span class="nav-number">4.</span> <span class="nav-text">内置模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#FS"><span class="nav-number">4.1.</span> <span class="nav-text">FS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PATH"><span class="nav-number">4.2.</span> <span class="nav-text">PATH</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#URL"><span class="nav-number">4.3.</span> <span class="nav-text">URL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP"><span class="nav-number">4.4.</span> <span class="nav-text">HTTP</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建静态资源服务器"><span class="nav-number">5.</span> <span class="nav-text">创建静态资源服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JS中的同步异步编程"><span class="nav-number">6.</span> <span class="nav-text">JS中的同步异步编程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#宏任务-macro-task-amp-微任务-micro-task"><span class="nav-number">6.1.</span> <span class="nav-text">宏任务(macro task) &amp; 微任务(micro task)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#node中独有的异步操作API"><span class="nav-number">6.2.</span> <span class="nav-text">node中独有的异步操作API</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Promise-A"><span class="nav-number">7.</span> <span class="nav-text">Promise A+</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Promise的封装"><span class="nav-number">7.1.</span> <span class="nav-text">Promise的封装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#本地存储-amp-服务器存储"><span class="nav-number">8.</span> <span class="nav-text">本地存储 &amp; 服务器存储</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LocalStorage-amp-Cookie"><span class="nav-number">8.1.</span> <span class="nav-text">LocalStorage &amp; Cookie</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Express"><span class="nav-number">9.</span> <span class="nav-text">Express</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#中间件"><span class="nav-number">9.1.</span> <span class="nav-text">中间件</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">卡而</span>

  
    <div class="powered-by">
        <i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
          本站访客数:<span id="busuanzi_value_site_uv"></span>
        </span>
    </div>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点字数总计&#58;</span>
    
    <span title="站点字数总计">98.1k</span>
  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'FTvPdsu2TK6x3E711x6QpQJD-gzGzoHsz',
        appKey: 'xPDqtHbApNKoxM9CeFc5bbUU',
        placeholder: '留言',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  

  

  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
    
  </script>

  

  

  

  

</body>
</html>
